# 测试配置说明文档

## 参数解释

### 基本参数格式
```bash
['-s', '4096', '-i', '1']
```

- **`-s 4096`**: 设置矩阵大小为 4096x4096
  - 矩阵元素总数: 4096² = 16,777,216 个整数
  - 内存使用量: 约 3 × 16.78M × 4 bytes = 192 MB
  - 计算量: 2 × 4096³ = 137.4 十亿次运算

- **`-i 1`**: 设置迭代次数为 1 次
  - 大矩阵计算时间长，减少迭代次数节省时间
  - 小矩阵可以多次迭代提高测量精度

## 完整测试配置 (512-8192)

### 小规模测试 (高精度)
```python
['-s', '512', '-i', '5']     # 512×512,  5次迭代
['-s', '1024', '-i', '5']    # 1024×1024, 5次迭代
```
- **内存**: 3-12 MB
- **时间**: 几毫秒到几十毫秒
- **用途**: 快速验证程序正确性，测量小规模性能

### 中等规模测试 (平衡)
```python
['-s', '1536', '-i', '3']    # 1536×1536, 3次迭代
['-s', '2048', '-i', '3']    # 2048×2048, 3次迭代
['-s', '2560', '-i', '2']    # 2560×2560, 2次迭代
['-s', '3072', '-i', '2']    # 3072×3072, 2次迭代
```
- **内存**: 27-113 MB
- **时间**: 几十毫秒到几秒
- **用途**: 评估中等负载下的性能表现

### 大规模测试 (压力测试)
```python
['-s', '4096', '-i', '1']    # 4096×4096, 1次迭代
['-s', '5120', '-i', '1']    # 5120×5120, 1次迭代
['-s', '6144', '-i', '1']    # 6144×6144, 1次迭代
['-s', '7168', '-i', '1']    # 7168×7168, 1次迭代
['-s', '8192', '-i', '1']    # 8192×8192, 1次迭代
```
- **内存**: 192 MB - 2.4 GB
- **时间**: 几秒到几十秒
- **用途**: 测试系统极限性能，评估内存带宽

## 内存使用量计算

```
内存使用量 = 3 × 矩阵大小² × sizeof(int)
           = 3 × N² × 4 bytes
```

| 矩阵大小 | 内存使用量 | 计算量 (GFLOP) |
|---------|-----------|----------------|
| 512     | 3.0 MB    | 0.27          |
| 1024    | 12.0 MB   | 2.15          |
| 1536    | 27.0 MB   | 7.24          |
| 2048    | 48.0 MB   | 17.18         |
| 2560    | 75.0 MB   | 33.55         |
| 3072    | 108.0 MB  | 57.98         |
| 4096    | 192.0 MB  | 137.44        |
| 5120    | 300.0 MB  | 268.44        |
| 6144    | 432.0 MB  | 463.68        |
| 7168    | 588.0 MB  | 736.05        |
| 8192    | 768.0 MB  | 1099.51       |

## 迭代次数选择策略

### 为什么不同大小使用不同迭代次数？

1. **小矩阵 (512-1024)**: 5次迭代
   - 计算时间短，多次测量提高精度
   - 减少测量误差的影响

2. **中等矩阵 (1536-3072)**: 2-3次迭代
   - 平衡测量精度和测试时间
   - 计算时间适中

3. **大矩阵 (4096-8192)**: 1次迭代
   - 计算时间长，单次测量已足够准确
   - 避免测试时间过长

## 性能测试模式

### 快速模式 (fast)
```python
test_configs = [
    ['-s', '512', '-i', '3'],
    ['-s', '1024', '-i', '3'],
    ['-s', '2048', '-i', '1'],
]
```
- **用途**: 快速验证系统性能
- **时间**: 约 1-2 分钟
- **适合**: 日常测试、CI/CD

### 完整模式 (full)
```python
# 11个测试点：512, 1024, 1536, 2048, 2560, 3072, 4096, 5120, 6144, 7168, 8192
```
- **用途**: 详细性能分析
- **时间**: 约 10-30 分钟（取决于硬件）
- **适合**: 性能评估、基准测试

### 自定义模式 (custom)
```bash
python3 report_generator.py custom
# 交互式输入矩阵大小和迭代次数
```
- **用途**: 特定需求测试
- **灵活**: 用户自定义配置
- **适合**: 特殊测试场景

## 实际使用示例

### 1. 系统性能评估
```bash
# 完整测试，生成详细报告
python3 report_generator.py full system_benchmark.html
```

### 2. 快速验证
```bash
# 快速测试，验证程序运行
python3 report_generator.py fast verification.html
```

### 3. 特定规模测试
```bash
# 自定义测试特定大小
python3 report_generator.py custom
# 输入: 1024 2048 4096
# 迭代: 3
```

### 4. 内存压力测试
```bash
# 直接运行大矩阵测试
./program_macos -s 8192 -i 1 -v
```

## 结果分析要点

1. **GFLOPS**: 绝对性能指标，越高越好
2. **加速比**: 多线程相对单线程的提升倍数
3. **效率**: 加速比除以线程数，理想值100%
4. **内存使用**: 确保不超出系统内存限制

## 注意事项

⚠️ **内存限制**: 确保系统有足够内存，8192×8192需要约768MB
⚠️ **测试时间**: 完整测试可能需要较长时间
⚠️ **系统负载**: 测试期间避免其他CPU密集型任务
⚠️ **热节流**: 长时间测试可能触发CPU降频
